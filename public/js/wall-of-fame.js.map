{"version":3,"file":"wall-of-fame.js","sources":["../../client/wall-of-fame.js"],"sourcesContent":["const socket = require(\"socket.io-client\")();\r\nconst { default: anime } = require(\"animejs\");\r\n\r\nconst imgSize = { width: 100, height: 100 };\r\nconst $wall = document.querySelector(\"#wall\");\r\n\r\nconst startScale = 5;\r\nconst blinkTime = 1000;\r\nconst animeDuration = 3000;\r\nconst showTimeout = 5000;\r\nlet showTimeoutId = null;\r\n\r\nhide();\r\n\r\n// TODO print/log error\r\nfunction onError(error) {\r\n  // eslint-disable-next-line\r\n  console.error(\"ERROR >>>\", error);\r\n}\r\n\r\nfunction random(min, max) {\r\n  return Math.random() * (max - min) + min;\r\n}\r\n\r\nfunction hide() {\r\n  $wall.style.display = \"none\";\r\n}\r\n\r\nfunction show(timeout = 0) {\r\n  $wall.style.display = \"block\";\r\n  showTimeoutId && clearTimeout(showTimeoutId);\r\n  showTimeoutId = setTimeout(hide, timeout || showTimeout);\r\n}\r\n\r\nfunction addSticker({ id, avatarURL, position }) {\r\n  const [w, h] = [imgSize.width * startScale, imgSize.height * startScale];\r\n  const [x, y] = [random(-200, 200), random(-200, 200)];\r\n  const $img = new Image(w, h);\r\n  $img.src = avatarURL;\r\n  $img.id = `user-${id}`;\r\n  $img.style.position = \"absolute\";\r\n  $img.style.top = `${window.innerHeight / 2 - h / 2 + y}px`;\r\n  $img.style.left = `${window.innerWidth / 2 - w / 2 + x}px`;\r\n  $img.style.borderRadius = random(0, 100) + \"%\";\r\n  $img.onload = () => {\r\n    show();\r\n    anime({\r\n      targets: $img,\r\n      top: position.y,\r\n      left: position.x,\r\n      width: imgSize.width,\r\n      height: imgSize.height,\r\n      delay: random(0, 2000),\r\n      duration: animeDuration\r\n    });\r\n    $wall.append($img);\r\n  };\r\n  $img.onerror = () => {\r\n    $img.remove();\r\n    onError(`Image not found (user-${id})`);\r\n    socket.emit(\"wof.image-not-found\", id);\r\n  };\r\n}\r\n\r\nfunction addStickers(users) {\r\n  Object.values(users)\r\n    .map(({ id, avatarURL, position }) => {\r\n      return avatarURL ? { id, avatarURL, position } : null;\r\n    })\r\n    .filter(item => item)\r\n    .forEach(addSticker);\r\n}\r\n\r\nsocket.on(\"wof.move\", chatMessage => {\r\n  const { id, position } = chatMessage.data.user;\r\n  const $img = document.querySelector(`#user-${id}`);\r\n  $img.style.top = `${position.y}px`;\r\n  $img.style.left = `${position.x}px`;\r\n});\r\n\r\nsocket.on(\"wof.add-user\", addSticker);\r\n\r\nsocket.on(\"wof.blink\", ({ user, count }) => {\r\n  const timeout = count * blinkTime;\r\n  const duration = blinkTime / 2;\r\n  const keyframes = [];\r\n\r\n  for (var i = 0; i < count; i++) {\r\n    keyframes.push({ scale: 2, duration }, { scale: 1, duration });\r\n  }\r\n\r\n  const targets = `#user-${user.id}`;\r\n  const $img = document.querySelector(targets);\r\n\r\n  const zIndex = $img.style.zIndex;\r\n  $img.style.zIndex = 9999;\r\n\r\n  show(timeout);\r\n  anime({\r\n    targets,\r\n    keyframes,\r\n    complete: () => {\r\n      $img.style.zIndex = zIndex;\r\n    }\r\n  });\r\n});\r\n\r\nfetch(\"/users\")\r\n  .then(response => response.json())\r\n  .then(addStickers)\r\n  .catch(onError);\r\n"],"names":["require$$0"],"mappings":"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"}